<!DOCTYPE html>
<html>
<head>
    <title>Grant Storage Access</title>
</head>
<body>
    <h2>Granting Storage Access...</h2>
    <script>
        async function grantAccess() {
            // Check if storage is already unlocked to avoid infinite redirect
            if (document.cookie.includes("storageUnlocked=true")) {
                console.log("âœ… Storage access already granted, returning to site.");
                const params = new URLSearchParams(window.location.search);
                const returnUrl = params.get("returnUrl") || "https://safari-test-local1.vercel.app";
                window.location.href = returnUrl;
                return;
            }

            if (document.requestStorageAccess) {
                try {
                    await document.requestStorageAccess();
                    document.cookie = "storageUnlocked=true; path=/; domain=.vercel.app; Secure; SameSite=None";
                    console.log("âœ… Storage access granted!");

                    // Redirect back to original site
                    const params = new URLSearchParams(window.location.search);
                    const returnUrl = params.get("returnUrl") || "https://safari-test-local1.vercel.app";
                    window.location.href = returnUrl;
                } catch (error) {
                    console.warn("ðŸš« Storage access denied:", error);
                }
            }
        }

        grantAccess();
    </script>
</body>
</html>
